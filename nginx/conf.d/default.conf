server {
    listen 80;
    server_name localhost;

    # 前端静态文件 (Vue 编译结果，存放在 www 目录)
    location / {
        root /var/www/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html;
    }

    # 后端 API 处理 (映射到 src/web/api 目录)
    location /api/ {
        # 使用 alias 将 /api/ 映射到实际的后端代码路径
        alias /var/www/src/web/api/;
        
        # 匹配以 .do 结尾的 PHP 请求
        location ~ \.do$ {
            fastcgi_pass php.zeabur.internal:9000;
            fastcgi_index index.do;
            include fastcgi_params;
            
            # 使用 $request_filename 确保 alias 后的路径能正确传递给 PHP
            fastcgi_param SCRIPT_FILENAME $request_filename;
            
            # 设置字符集，防止乱码
            default_type "text/html; charset=utf-8";
        }
    }

    location ~ /\.ht {
        deny all;
    }
}
